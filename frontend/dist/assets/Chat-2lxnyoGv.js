import{j as e,r as o,a as u,u as x,b as v,f,h as N,i as b,c as y,k}from"./index-BpUxnEab.js";import{C as D}from"./Container-Cfp1xiYM.js";import{D as _}from"./DummyUser-DHHqRRpg.js";import{c as h}from"./createLucideIcon-Cd_Ik4SM.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],I=h("paperclip",w);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]],C=h("send-horizontal",M);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],E=h("x",S);function F(){return e.jsx(e.Fragment,{children:[...Array(3)].map((t,a)=>e.jsxs("div",{children:[e.jsxs("div",{className:"py-3 flex gap-3 items-center",children:[e.jsx("div",{className:"skeleton w-10 h-10 rounded-full shrink-0"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"skeleton h-4 w-40"}),e.jsx("div",{className:"skeleton h-4 w-40"})]})]}),e.jsxs("div",{className:"flex gap-3 items-center justify-end",children:[e.jsx("div",{className:"flex flex-col gap-1",children:e.jsx("div",{className:"skeleton h-4 w-40"})}),e.jsx("div",{className:"skeleton w-10 h-10 rounded-full shrink-0"})]})]},a))})}function z({messages:t,user:a}){const l=o.useRef(null),{selectedUser:r}=u(s=>s.users);return o.useEffect(()=>{if(!t.length)return;const s=t[t.length-1];if(!s)return;const i=s.senderID===a._id;l.current?.scrollIntoView({behavior:i?"auto":"smooth"})},[t,a._id]),e.jsxs(e.Fragment,{children:[t.map(s=>e.jsxs("div",{className:`chat ${s.senderID===a?._id?"chat-end":"chat-start"}`,children:[e.jsx("div",{className:"chat-image avatar",children:e.jsx("div",{className:"w-10 rounded-full",children:e.jsx("img",{src:s.senderID===a._id?a.profilePic:r.profilePic||_,alt:"user"})})}),e.jsxs("div",{className:"chat-header flex flex-col items-end gap-2",children:[e.jsx("time",{className:"chat-footer opacity-50",children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),s.image&&e.jsx("img",{src:s.image,alt:"Shared",className:"rounded-lg h-30 object-cover cursor-pointer mb-1"})]}),s.text&&e.jsx("div",{className:`chat-bubble ${s.senderID===a?._id?"bg-primary text-primary-content":"bg-secondary text-secondary-content"} relative`,children:s.text}),s.senderID===a._id&&e.jsx("time",{className:"text-xs opacity-50",children:"sent"})]},s._id)),e.jsx("div",{ref:l})]})}function T(){const t=x(),a=v(),{id:l}=f(),[r,s]=o.useState(""),[i,n]=o.useState(null);o.useEffect(()=>{(r||i)&&(s(""),n(null))},[l]);function m(){!r.trim()&&!i||(t(N({id:l,mess:{text:r,image:i}})),s(""),n(null))}function p(c){c.key==="Enter"&&(c.preventDefault(),m()),c.key==="Escape"&&a("/")}function j(c){const g=c.target.files[0],d=new FileReader;d.onloadend=()=>{n(d.result)},d.readAsDataURL(g)}return e.jsxs(e.Fragment,{children:[i&&e.jsx("div",{className:"",children:e.jsxs("div",{className:"avatar",children:[e.jsx("img",{src:i,className:"ml-4 w-25 h-25 object-cover rounded-lg mb-2 relative"}),e.jsx(E,{size:20,className:"absolute top-0 right-0 bg-emerald-400 rounded-lg hover:bg-indigo-300",onClick:()=>n("")})]})}),e.jsx("section",{className:"bg-base-300 w-full border border-emerald-400 outline-indigo-500 rounded-xl",children:e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"cursor-pointer absolute top-3 left-2",children:[e.jsx("input",{type:"file",hidden:!0,onChange:j}),e.jsx(I,{size:25,className:""})]}),e.jsx("input",{type:"text",autoComplete:"off",name:"message",className:"w-full border-emerald-400 outline-indigo-500 rounded-xl px-10 py-3 ",placeholder:"Type a message...",value:r,onChange:c=>s(c.target.value),onKeyDown:p}),e.jsx("button",{type:"button",disabled:!r&&!i,className:`absolute top-2 right-3 ${!r&&!i?"cursor-not-allowed":"cursor-pointer"}`,onClick:m,children:e.jsx(C,{size:30,className:""})})]})})]})}function A(){const{id:t}=f(),a=x(),{messages:l,isLoading:r}=u(n=>n.messages),{user:s}=u(n=>n.auth),i=y();return o.useEffect(()=>{a(b(t))},[a,t]),o.useEffect(()=>(i.on("receiveMessage",n=>{(n.senderID===t&&n.receiverID===s._id||n.senderID===s._id&&n.receiverID===t)&&a(k(n))}),()=>{i.off("receiveMessage")}),[a,t,s._id]),e.jsx(e.Fragment,{children:e.jsxs(D,{heading:"Chat",footer:e.jsx(T,{}),children:[r&&e.jsx(F,{}),!r&&e.jsx(z,{messages:l,user:s})]})})}export{A as default};
